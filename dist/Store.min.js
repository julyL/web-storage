!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Store=e()}(this,function(){"use strict";function t(e,r){if(Array.isArray(r))return r.reduce(function(t,e){return t&&t[e]?t[e]:void 0},e);if("string"==typeof r){var n,o=[];return r.split(".").forEach(function(t){(n=t.match(/([^\[\]]+)|(\[\d+\])/g))&&(n=n.map(function(t){return t.replace(/\[(\d+)\]/,"$1")}),[].push.apply(o,n))}),t(e,o)}}function e(t,e){return e&&parseInt(t)==t&&/^(([1-9]\d*)|0)$/.test(t)?new Array(parseInt(t)):{}}function r(t,n,o,i){if(Array.isArray(n)){for(var a,c,l=t,u=[],p=0,f=n.length;p<=f-1;p++)a=n[p],"object"==(void 0===l?"undefined":s(l))&&null!=l?(u.push(l),c=l[a],p==f-1?l[a]=o:c&&"object"==(void 0===c?"undefined":s(c))||(l[a]=e(n[p+1],i))):(l=e(a,i),u.push(l),l[a]=p==f-1?o:e(n[p+1],i)),l=l[a];return u[0]}if("string"==typeof n){var _,h=[];return n.split(".").forEach(function(t){(_=t.match(/([^\[\]]+)|(\[\d+\])/g))&&(_=_.map(function(t){return t.replace(/\[(\d+)\]/,"$1")}),[].push.apply(h,_))}),r(t,h,o,i)}}function n(t,e){for(var r in e)t[r]=e[r];return t}function o(t){return"object"===(void 0===t?"undefined":s(t))&&"__start__"in t&&"__end__"in t&&"__data__"in t}function i(t,e){var r,i,a,s=[].slice.call(arguments,2);if(r=t.apply(this,s),this.opts.debug){i=n({},this.getAllStorage());for(var c in i)i.hasOwnProperty(c)&&(o(a=this.opts.deserialize(i[c]))?i[c]={__start:new Date(a.__start__).toUTCString(),__end__:new Date(a.__end__).toUTCString(),__data__:a.__data__}:delete i[c]);console.log(e+"("+(s[0]?'"'+s[0]+'"':"")+(s[1]?", "+this.opts.serialize(s[1]):"")+(s[2]?", "+JSON.stringify(s[2]):"")+")","\n   =>  ",i)}return r}function a(t,e,n){var i=this.opts;n&&n.exp&&(i.exp=n.exp);var a=this.getAllStorage(),s=(t=i.namespace?"__namespace__"+i.namespace+"."+t:t).split(".")[0],c=i.deserialize(a[s]),l=+new Date,u=l+100*i.exp;o(c)||(c={__start__:void 0,__data__:void 0,__end__:void 0}),this.setItem.call(window[i.Storage],s,i.serialize({__start__:l,__end__:u,__data__:r(c.__data__,t,e,i.parseToArray)}))}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=(function(){function t(t){this.value=t}function e(e){function r(o,i){try{var a=e[o](i),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){r("next",t)},function(t){r("throw",t)}):n(a.done?"return":"normal",a.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?r(o.key,o.arg):i=null}var o,i;this._invoke=function(t,e){return new Promise(function(n,a){var s={key:t,arg:e,resolve:n,reject:a,next:null};i?i=i.next=s:(o=i=s,r(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(){}),l=function t(e){function r(t){var e=o.opts.polyfill[t];if(e===c)return"getAllStorage"==t?function(t){return window[o.opts.Storage]}:window[o.opts.Storage][t];if("function"==typeof fn)return e;throw new TypeError("Polyfill "+t+" should be a function")}var o=this,i={namespace:"",debug:!1,Storage:"localStorage",exp:31536e6,serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return t&&JSON.parse(t)},parseToArray:!0,polyfill:{setItem:c,removeItem:c,getAllStorage:c}};if(!(this instanceof t))throw new TypeError("Failed to construct 'Store': Please use the 'new' operator, this object constructor cannot be called as a function.");this.opts=n(i,e),this.setItem=r("setItem"),this.removeItem=r("removeItem"),this.getAllStorage=r("getAllStorage")};return l.prototype={constructor:l,get:function(){return i.call.apply(i,[this,function(e){var r=this.getAllStorage(),n=e,i=(e=this.opts.namespace?"__namespace__"+this.opts.namespace+"."+e:e).split(".")[0],a=this.opts.deserialize(r[i]);if(o(a)){if(!(+new Date>=a.__end__))return t(a.__data__,e);this.remove(this.opts.namespace?n:i)}},"get"].concat(Array.prototype.slice.call(arguments)))},set:function(){return i.call.apply(i,[this,a,"set"].concat(Array.prototype.slice.call(arguments)))},remove:function(){return i.call.apply(i,[this,function(t){this.opts.namespace?a.call(this,t,""):this.removeItem.call(window[this.opts.Storage],t)},"remove"].concat(Array.prototype.slice.call(arguments)))},clearAllExpires:function(){return i.call.apply(i,[this,function(){var t,e=this.getAllStorage(),r=+new Date;for(var n in e)e.hasOwnProperty(n)&&o(t=this.opts.deserialize(e[n]))&&r>=t.__end__&&this.removeItem.call(window[this.opts.Storage],n)},"clearAllExpires"].concat(Array.prototype.slice.call(arguments)))},isSupported:function(){return function(t){var e=!1;if(t&&t.setItem){e=!0;var r="__"+Math.round(1e7*Math.random());try{t.setItem(r,r),t.removeItem(r)}catch(t){e=!1}}return e}(window[this.opts.Storage])}},l});
