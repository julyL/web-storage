!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Store=e()}(this,function(){"use strict";function t(e,r){if(Array.isArray(r))return r.reduce(function(t,e){return t&&t[e]?t[e]:void 0},e);if("string"==typeof r){var n,o=[];return r.split(".").forEach(function(t){(n=t.match(/([^\[\]]+)|(\[\d+\])/g))&&(n=n.map(function(t){return t.replace(/\[(\d+)\]/,"$1")}),[].push.apply(o,n))}),t(e,o)}}function e(t,e){return e&&parseInt(t)==t&&/^(([1-9]\d*)|0)$/.test(t)?new Array(parseInt(t)):{}}function r(t,n,o,a){if(Array.isArray(n)){for(var u,s,f=t,c=[],l=0,p=n.length;l<=p-1;l++)u=n[l],"object"==(void 0===f?"undefined":i(f))&&null!=f?(c.push(f),(s=f[u])&&"object"==(void 0===s?"undefined":i(s))?f[u]=s:f[u]=l==p-1?o:e(n[l+1],a)):(f=e(u,a),c.push(f),f[u]=l==p-1?o:e(n[l+1],a)),f=f[u];return c[0]}if("string"==typeof n){var d,_=[];return n.split(".").forEach(function(t){(d=t.match(/([^\[\]]+)|(\[\d+\])/g))&&(d=d.map(function(t){return t.replace(/\[(\d+)\]/,"$1")}),[].push.apply(_,d))}),r(t,_,o,a)}}function n(t,e){for(var r in e)t[r]=e[r];return t}function o(t){return"object"===(void 0===t?"undefined":i(t))&&"__start__"in t&&"__end__"in t&&"__data__"in t}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=(function(){function t(t){this.value=t}function e(e){function r(o,i){try{var a=e[o](i),u=a.value;u instanceof t?Promise.resolve(u.value).then(function(t){r("next",t)},function(t){r("throw",t)}):n(a.done?"return":"normal",a.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?r(o.key,o.arg):i=null}var o,i;this._invoke=function(t,e){return new Promise(function(n,a){var u={key:t,arg:e,resolve:n,reject:a,next:null};i?i=i.next=u:(o=i=u,r(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}),u=function(){},s=function(t){var e=!1;if(t&&t.setItem){e=!0;var r="__"+Math.round(1e7*Math.random());try{t.setItem(r,r),t.removeItem(r)}catch(t){e=!1}}return e}(localStorage),f={Storage:"localStorage",exp:31536e5,serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return t&&JSON.parse(t)},parseToArray:!0,polyfill:{setItem:u,removeItem:u,getAllStorage:u}},c=function t(e){function r(t){var e=o.opts.polyfill[t];if(e===u)return"getAllStorage"==t?function(){return window[o.opts.Storage]}:window[o.opts.Storage][t];if("function"==typeof fn)return e;throw new TypeError("Polyfill "+t+" should be a function")}var o=this;if(!(this instanceof t))throw new TypeError("Failed to construct 'Store': Please use the 'new' operator, this object constructor cannot be called as a function.");this.opts=n(f,e),this.setItem=r("setItem"),this.removeItem=r("removeItem"),this.getAllStorage=r("getAllStorage")};return c.prototype={constructor:c,get:function(e){var r=this.getAllStorage(),n=e.split(".")[0],i=this.opts.deserialize(r[n]);if(o(i)){if(!(+new Date>=i.__end__))return t(i.__data__,e);this.remove.call(window[this.opts.Storage],n)}},set:function(t,e,i){i=n(this.opts,i);var u,s=this.getAllStorage(),f=t.split(".")[0],c=this.opts.deserialize(s[f]),l=+new Date,p=l+1e3*i.exp;o(c)||(c=a({__start__:void 0,__data__:void 0},"__data__",void 0)),u=r(c.__data__,t,e,this.opts.parseToArray),this.setItem.call(window[this.opts.Storage],f,i.serialize({__start__:l,__end__:p,__data__:u}))},remove:function(t){this.removeItem.call(window[this.opts.Storage],t)},isSupported:s,clearAllExpires:function(){var t,e=this.getAllStorage(),r=+new Date;for(var n in e)e.hasOwnProperty(n)&&o(t=this.opts.deserialize(e[n]))&&r>=t.__end__&&this.removeItem(n)}},c});
